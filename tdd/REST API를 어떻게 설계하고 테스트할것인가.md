# REST API를 어떻게 설계하고 테스트할것인가?

[REST API 테스트 수행 가이드](https://www.slideshare.net/genycho/rest-api-64569519)를 보고 정리한것



## REST API 디자인 규칙

### URI 식별자 설계

1. URI 형태

- 슬래시 구분자(/)는 계층관계를 나타내는 데 사용한다.
- URI 마지막 문자로 슬래시(/)를 포함하지 않는다.
- 하이픈(-)은 URI 가독성을 높이는 데 사용한다.
- 밑줄(_)은 URI에 사용하지 않는다.
- URI 경로에 소문자가 적합하다.
- 파일 확장자는 URI에 포함하지 않는다.

2. 권한 설계

- API에 있어 서브 도메인은 일관성있게 사용해야한다.
- 클라이언트 개발자 포탈 서브 도메인 이름은 일관성 있게 만들어야한다.

3. URI 경로 디자인

- 도큐먼트 이름은 단수 명사를 사용해야한다.
- 컬렉션 이름으로는 복수 명사를 사용해야한다.
- 스토어 이름으로는 복수 명사를 사용해야한다.
- 컨트롤러 이름으로는 동사나 동사구를 사용해야 한다.
- 경로 부분 중 변하는 부분은 유일한 값으로 대체한다.
- CRUD 기능을 나타내는 것은 URI에 사용하지 않는다.

4. Query String 디자인

- URI 쿼리 부분으로 컬렉션이나 스토어를 필터링할 수 있다.
- URI 쿼리는 컬렉션이나 스토어의 결과를 페이지로 구분하여 나타내는데 사용해야한다.

### HTTP를 이용한 인터랙션 설계

1. 요청 메서드

- GET, POST 메서드를 사용하여 다른 요청 메서드를 처리해서는 안된다.
- GET 메서드는 리소스의 상태 표현을 얻는데 사용해야 한다.
- 응답 헤더를 가져올 때는 반드시 HEAD 메서드를 사용해야 한다.
- PUT 메서드는 리소스를 삽입하거나 저장된 리소스를 갱신하는 데 사용해야 한다.

- PUT 메서드는 변경 가능한 리소스를 갱신하는 데 사용해야 한다.
- POST 메서드는 컬렉션에 새로운 리소스를 만드는데 사용해야 한다.
- POST 메서드는 컨트롤러를 실행하는 데 사용해야 한다.
- DELETE 메서드는 그 부모에서 리소스를 삭제하는 데 사용해야 한다.
- OPTIONS 메서드는 리소스의 사용 가능한 인터랙션을 기술한 메타데이터를 가져오는 데 사용해야 한다.

2. 응답 상태 코드

- 200은 일반적인 요청 성공을 나타내는 데 사용해야 한다.
- 200은 응답 바디에 에러 전송하는데 사용해서는 안된다.
- 201은 성공적으로 리소스를 생성했을 때 사용해야 한다.
- 202는 비동기 처리가 성공적으로 시작되었음을 알릴 때 사용해야 한다.
- 204는 응답 바디에 의도적으로 아무것도 포함하지 않을 때 사용한다.
- 301은 리소스를 이동시켰을 때 사용한다.
- 302는 사용하지 않는다.
- 303은 다른 URI를 참조하라고 알려줄 때 사용한다.
- 304는 대역폭을 절약할 때 사용한다.
- 307은 클라이언트가 다른 URI로 요청을 다시 보내게 할 때 사용해야 한다.
- 400은 일반적인 요청 실패에 사용해야 한다.
- 401은 클라이언트 인증 문제가 있을 때 사용해야한다.
- 403은 인증상태에 상관없이 액세스를 금지할 때 사용한다.
- 404는  요청 URI에 해당하는 리소스가 없을 때 사용한다.
- 405는 HTTP 메서드가 지원되지 않을 때 사용해야한다.
- 406은 요청 리소스 미디어 타입을 제공하지 못할 때 사용해야한다.
- 409는 리소스 상태에 위반되는 행위에 사용된다.
- 412는 조건부 연산을 지원할 때 사용한다.
- 415는 요청의 페이로드에 있는 미디어 타입이 처리되지 못했을 때 사용해야 한다.
- 500은 API가 잘못 작동할 때 사용한다.

### 표현 디자인

1. 오류 표현

- 오류, 오류 응답은 일관성있게 표현한다.
- 일반적 오류 상황에서는 일관성 있는 오류 타입을 사용한다.



## API 문서에 무엇을 명시할 것인가



1. 요청 변수

- Key (요청 변수)
- Value (값): 값의 형태를 포함(string, int 등등)
- Description



2. 응답 결과

- Key
- Value
- Description



3. 응답 코드

400 Bad Request에 대해 에러 코드를 정의하고 상세한 에러 사유를 전달한다.



4. 공통 에러 코드



## 테스트 접근 전략

API의 오픈 정도, 대상, 중요도에 따라 테스트 설계 수준을 지정한다.

1. 기본적인 테스트

필수 입력 값/모든 입력 값에 대한 기본적인 테스트

2. 응답코드 기반 테스트

스펙에 정의된 응답코드별 테스트

3. 메소드 타입별 테스트

Get/Post/Put/Delete 방식에 따른 테스트 접근

4. 입력 파라미터에 따른 테스트

입력 값의 타입, 코드형, 범위, 순서에 따른 테스트

5. 비즈니스 흐름 기반 테스트

보다 복잡한 정황에 따른 테스트



*(공통) 인증, 인코딩, 타임존 등에 대한 테스트



### 1. 기본 테스트

- 필수 입력 값/ 모든 입력 값 2개의 테스트 케이스로 테스트를 수행하고 그 결과가 맞는지 상세하게 확인한다.



### 2. 응답코드 기반 테스트

- __스펙에 정의된 응답코드__ 별로 해당 응답코드를 발생시키는 테스트 케이스를 한개씩 생성



### 3. 메소드 타입별 테스트

- GET/POST/PUT/DELETE 방식에 따른 테스트 접근
  - GET은 조회 결과가 있을 때와 없을 때
  - POST는 로직적으로 유니크해야 하는 값을 넣었을 때나 이미 있는 값에 또 등록을 시도할 때
  - PUT은 존재하지 않는 데이터에 대한 수정 시도 외에 POST와 유사한 테스트
  - DELETE는 존재하지 않는 데이터에 대한 삭제 시도나, 하위 데이터가 존재하는 경우 상위 데이터 삭제 시도 등을 테스트



### 4. 입력 파라미터에 따른 테스트

- 입력 값의 타입 - String, 숫자, 정해진 코드, 날짜, 범위형 변수에 따른 테스트 설계
- 잘못된 입력 값에 대해 필요에 따라 적절한 에러와 메세지를 제공해주는지 확인한다.



### 5. 비즈니스 흐름 기반 테스트

- 복잡한 정황을 고려하여 다른 API와의 호출관계, 자원의 상태나 존재 유무에 따른 테스트를 고민한다.
- (예 1) 재고가 떨어진 제품에 대해 구매 요청시 현재 재고가 아닌 예약 주문의 수량 증가 확인
- (예 2) 회원가입이 되어 있지 않은 사용자가 구매 신청시 게스트 ID가 부여되어 진행된다.
- (예 3) 권한에 대한 테스트



### 6. 공통

- 인증되지 않은 요청에 대한 에러코드 반환
- 인코딩이 맞지 않았을 때의 테스트